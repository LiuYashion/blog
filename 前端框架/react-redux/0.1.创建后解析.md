# 新建之后
先整合好reducer, 创建store放在全局下
```js
const store = createStore(reducer)

/** store的结构
  {
    dispatch: ƒ, 
    subscribe: ƒ, 
    getState: ƒ, 
    replaceReducer: ƒ, 
    Symbol(observable): ƒ
  }
 */

render(
  <Provider store={store}>
    <App/>
  </Provider>,
  document.getElementById('root')
)
```

## Provider中
所以Provider提供了store, Provider的孩子是Todo组件
```js
class Provider extends Component {
  
  getChildContext() {
    return { 
      store: this.store, 
      storeSubscription: null 
    }
  }

  constructor(props, context) {
    super(props, context)
    this.store = props.store;
  }

  render() {
    //渲染子元素
    return Children.only(this.props.children)
  }
}
```


## App中
使用connect包装了Todo(App)
```js
class Todo extends React.Component {
  constructor(props) {
    super(props);

    /** 此处props的结构
      {
        todos: Array[1], 
        actions: Object
      }
    */
  }
}

const mapStateToProps = state => ({
  todos: state.todos
})

const mapDispatchToProps = dispatch => ({
    actions: bindActionCreators(TodoActions, dispatch)
})

export default connect(
  mapStateToProps,
  mapDispatchToProps
)(Todo)
```






## connect中
props来自selector
```js
this.addExtraProps(selector.props)
```




## selector

```js

//Connect组件会获取上下文
const contextTypes = {
  store: storeShape,
  storeSubscription: subscriptionShape,
}

//传给孩子的
getChildContext() {
  const subscription = this.propsMode ? null : this.subscription
  return { 
    storeSubscription: subscription || this.context.storeSubscription 
  }
}


initSelector() {
  /** 别的不管, 这里向run里面传入了this.props */
  this.selector.run(this.props)
}
```

