# 跨域
跨域是指没有建立信任关系的两个域之间的通信，浏览器默认是禁止跨域的

## 1.0 跨域分类
- 域名不一致：http://www.baidu.com | http://www.zhihu.com
- 端口不一致：http://www.baidu.com | http://www.baidu.com:8080
- 协议不一致：http://www.baidu.com | https://www.baidu.com 

## 2.0 解决跨域问题

### 反向代理
跨域问题的产生，是浏览器的同源策略。服务器之间的数据交换是没有问题的

反向代理就是这个原理：启动一个代理服务器，来请求链接，并将结果返回给客户端

### 解决方案

### 1.gulp/grunt/webpack等脚手架
类似脚手架都是相似的
```js
module.exports = {
  devServer:{
    contentBase: './build/',
    inline: true,       // 可以监控js变化
    hot: true,          // 热启动
    host:'localhost',
    proxy: {
      '/qqagent': {
        target: 'https://qq-ci.crfchina.com/',
        secure: false,
        changeOrigin: true
      }
    }
  }
}
```



### 2.JSONP
利用js访问没有跨域限制
```js
router.get('/jsonp', function(req, res, next) {
  var userName = req.query.uname;
  var password = req.query.pwd;
  var data = {
      code: 200,
      user: userName,
      password: password
  }
  res.jsonp(data);
});

$.ajax({
  async: true,
  url: "http://localhost:3000/jsonp",
  type: "GET",
  dataType: "jsonp", // 返回的数据类型，设置为JSONP方式
  jsonp: 'callback', //指定一个查询参数名称来覆盖默认的 jsonp 回调参数名 callback
  jsonpCallback: 'xxx', //设置回调函数名
  data: {/** ... */},
  success: function(response, status, xhr) {
    console.log(response);
  },
});
```



### 3.CROS
通过设置http请求头来实现跨域资源共享
```js
router.get('/cors', function(req, res, next) {
  var userName = req.query.uname;
  var password = req.query.pwd;
  var data = {
      code: 200,
      user: userName,
      password: password
  }
  res.header("Access-Control-Allow-Origin", "*"); // *代表接受任何域名跨域,可使用指定ip替换*
  res.header('Access-Control-Allow-Methods', 'GET, POST');//用来列出浏览器的cors请求还会用到那些http方法.
  res.header('Access-Control-Allow-Headers', 'X-Requested-With,content-type, Authorization');//用来指定浏览器cors请求发送的头信息字段,可不写
  res.send(data);
});

$.ajax({
  url: "http://localhost:3000/cors",
  type: "get",
  data: {
      "uname": 'cors',
      "pwd": "123"
  },
  success: function(data) {
      console.log(data);
  },
  error: function() {
      console.log('fail');
  }
});
```


